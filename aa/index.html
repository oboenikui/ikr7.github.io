<!DOCTYPE html>
<html>
	<head>
		<meta charset='UTF-8'>
		<style>

canvas{
	transform: scaleX(-1) rotate(90deg);
		-webkit-transform: scaleX(-1) rotate(90deg);
		-moz-transform: scaleX(-1) rotate(90deg);
	float: left;
}

div{
	line-height: 1em;
	letter-spacing: 0;
	float:left;
}

p{
	clear: both;
}

		</style>
	</head>
	<body>
		<h1>AAっぽいの</h1>
		<p>同一生成元ポリシーがアレなので好きな画像で遊びたいときはDLしてね(おなじディレクトリにimage.pngを入れろ(正方形の方がいいです))</p>
		<input value='　▁▂▄▅▇█'>
		<input type='button' value='うん'><br>
		<canvas></canvas>
		<div></div>
		<p>阿部寛さんありがとうございました</p>
		<script>

document.querySelectorAll('input').item(0).addEventListener('change', app, false);
document.querySelectorAll('input').item(1).addEventListener('click', app, false);
app();

function app(){
	var cvs = document.querySelector('canvas');
	cvs.width = 512;
	cvs.height = 512;

	var dotSize = 16;

	var ctx = cvs.getContext('2d');

	//var chars = '　、＿＾｜〜／＝イい＃あ禅鬱█'.split('').reverse();
	var chars = document.querySelector('input').value.split('').reverse();
	//var chars = '　▏▍▌▋▊▉█'.split('').reverse();
	//var chars = '　・ー〜＝＃Ｇ'.split('').reverse();

	var o = document.querySelector('div');
	o.innerHTML = '';

	var image = new Image();
	image.src = './image.png'
	image.addEventListener('load', function(){
		
		ctx.fillStyle = '#FFFFFF';
		ctx.fillRect(0, 0, cvs.width, cvs.height);
		ctx.translate(cvs.width / 2, cvs.height / 2);
		ctx.rotate(270 * Math.PI / 180);
		ctx.scale(-1, 1);
		ctx.translate(-cvs.width / 2, -cvs.height / 2);
		
		ctx.drawImage(image, 0, 0, cvs.width, cvs.height);	
		
		for(var i = 0; i < cvs.width; i += dotSize){
			for(var j = 0; j < cvs.height; j += dotSize){
				
				var originalChunk = ctx.getImageData(i, j, dotSize, dotSize);

				var r = 0, g = 0, b = 0, a = 0;

				for(var k = 0; k < originalChunk.data.length / 4; k++){
					r += originalChunk.data[k * 4 + 0];
					g += originalChunk.data[k * 4 + 1];
					b += originalChunk.data[k * 4 + 2];
					a += originalChunk.data[k * 4 + 3];
				}

				o.innerHTML += chars[(r + g + b + a) / 262140 * chars.length | 0];

			}
			o.innerHTML += '<br>';
		}
	}, false);
}

		</script>
	</body>
</html>