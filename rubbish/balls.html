<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<style>

body {
    margin: 0;
    overflow: hidden;
}

div{
	position: absolute;
}

</style>
</head>
<body>
<div>なんというか収束する感じ</div>
<canvas></canvas>
<script>

var keyState = [];

window.addEventListener('keydown', function(e){
	e = e ? e : event;
	keyState[e.keyCode] = true;
}, false);

window.addEventListener('keyup', function(e){
	e = e ? e : event;
	keyState[e.keyCode] = false;
}, false);

var canvas = document.querySelector('canvas');
var context = canvas.getContext('2d');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

var BALL_COUNT = 300;
var FRAMERATE = 60; //fps

var createBall = function(){
	return {
		'x': Math.random() * context.canvas.width | 0, 
		'y': Math.random() * context.canvas.height | 0, 
		'nextx': 0, 
		'nexty': 0, 
		'r': Math.random() * 30 | 0, 
		'angle': Math.random() * 360 | 0, 
		'vel': {
			'x': 50, 
			'y': 50
		}, 
		'color': {
			'h': Math.random() * 360 | 0, 
			's': 100, 
			'l': 50, 
			'a': 1
		}
	};
};

var balls = [];

for(var i = 0; i < BALL_COUNT; i++){
	balls.push(createBall());
}

var update = function(){

	context.fillStyle = 'rgba(255, 255, 255, 1)';
	context.fillRect(0, 0, context.canvas.width, context.canvas.height);

	balls.forEach(function(ball, i){

		balls.forEach(function(otherBall, j){
			if(j != i){
				var distance = Math.sqrt(Math.pow(ball.x - otherBall.x, 2) + Math.pow(ball.y - otherBall.y, 2));
				if(distance < ball.r + otherBall.r){
					if(ball.r < otherBall.r){
						ball.color.h = otherBall.color.h;
					}else if(ball.r > otherBall.r){
						otherBall.color.h = ball.color.h;
					}
				}
			}
		});

		if(ball.x < 0 + ball.r || ball.x > context.canvas.width - ball.r){
			ball.angle = (180 - ball.angle) % 360;
		}

		if(ball.y < 0 + ball.r || ball.y > context.canvas.height - ball.r){
			ball.angle = (360 - ball.angle) % 360;
		}

		ball.x += Math.cos(ball.angle * Math.PI / 180) * ball.vel.x / ball.r;
		ball.y += Math.sin(ball.angle * Math.PI / 180) * ball.vel.y / ball.r ;

		context.beginPath();
		context.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2, false);
		
		context.fillStyle = 'hsla(' + ball.color.h + ',' + ball.color.s + '%,' + ball.color.l + '%,' + ball.color.a + ')';
		context.fill();

	});

	//setTimeout(update, 1000 / FRAMERATE);
	requestAnimationFrame(update);

};

update(0);

</script>
</body>
</html>
